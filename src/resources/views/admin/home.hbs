
<style>
    #transactions-list {
        max-height: 200px; /* Bạn có thể điều chỉnh tùy theo thiết kế */
        overflow-y: auto;
        padding-right: 8px; /* để tránh thanh cuộn đè lên nội dung */
    }

    .transaction-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
    }

    .transaction-divider {
        border-bottom: 1px solid #ccc;
        margin: 0 0 8px 0;
    }

    body {
        background: #f8f9fa;
    }

    .circle-container {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        font-size: 25px;
        font-weight: bold;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
    }

    .residents-circle {
        background-color: #FAA644;
    }

    .apartments-circle {
        background-color: #44C5E1;
        color: black;
    }

    .outer-ring {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .outer-ring circle {
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        transform: rotate(-90deg);
        transform-origin: center;
    }

    .vehicle-container {
        max-width: 400px;
        display: flex;
        flex-direction: column;
        align-items: start;
        z-index: 10;
    }

    .vehicle-type {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        font-weight: 500;
    }

    .dot {
        border-radius: 50%;
        height: 9px;
        width: 9px;
    }

    .bg-indigo-500 {
        background-color: #6366F1;
    }

    .bg-indigo-400 {
        background-color: #818CF8;
    }

    .bg-indigo-200 {
        background-color: #C7D2FE;
    }

    .transactions-container {
        width: 400px;
        max-height: 300px;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .transaction-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
    }

    .transaction-divider {
        border-top: 1px solid #ddd;
        margin: 10px 0;
    }

    .chart-bar {
        width: 15px;
        display: inline-block;
        margin: 0 8px;
    }

    .regular-bar {
        background-color: #4F46E5;
        /* Màu xanh đậm */
    }

    .voluntary-bar {
        background-color: #D1D5DB;
        /* Màu xám nhạt */
    }

    .month-label {
        text-align: center;
        font-size: 12px;
        color: #6c757d;
    }

    .vehicle-container {
        max-width: 400px;
        display: flex;
        flex-direction: column;
        align-items: start;
        z-index: 10;
    }

    .vehicle-type {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        font-weight: 500;
    }

    .dot {
        border-radius: 50%;
        height: 9px;
        width: 9px;
    }

    .bg-indigo-500 {
        background-color: #6366F1;
    }

    .bg-indigo-400 {
        background-color: #818CF8;
    }

    .bg-indigo-200 {
        background-color: #C7D2FE;
    }

    .chart-container {
        position: relative;
        width: 280px;
        height: 150px;
        margin: auto;
    }

    .circle {
        fill: none;
        stroke-width: 20;
        transform: rotate(-90deg);
        transform-origin: center;
        cx: 75;
        cy: 75;
        r: 50;
    }
</style>

<div class="container ">
    <div class="row g-4">
        <!-- Cột 1: Doanh thu và Dân cư -->
        <div class="col-md-8">
            <!-- Doanh thu -->
            <section class="bg-white p-4 rounded shadow">
                <h2 class="text-sm fw-bold text-dark" id="revenue-title">Doanh thu tháng {{currentMonth}}/{{currentYear}}
                </h2>
                <span class="fw-semibold ${spanClass}">{{growthPercentage}}%</span>
                <span class="text-muted"> so với tháng trước</span>
            </section>
            <section class="bg-white p-4 rounded shadow">
                <h2 class="text-sm fw-bold text-dark" id="revenue-title">Doanh thu năm {{currentYear}}
                </h2>

                {{!-- <!-- Biểu đồ doanh thu (HTML tĩnh) -->
                <div class="d-flex align-items-end gap-3 mt-4" id="chart-container">
                    <!-- Tháng 1 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 40px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 22.5px;"></div>
                        <span class="month-label mt-2">1</span>
                    </div>
                    <!-- Tháng 2 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 45px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 25px;"></div>
                        <span class="month-label mt-2">2</span>
                    </div>
                    <!-- Tháng 3 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 35px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 45px;"></div>
                        <span class="month-label mt-2">3</span>
                    </div>
                    <!-- Tháng 4 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 42.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 30px;"></div>
                        <span class="month-label mt-2">4</span>
                    </div>
                    <!-- Tháng 5 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 30px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 40px;"></div>
                        <span class="month-label mt-2">5</span>
                    </div>
                    <!-- Tháng 6 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 47.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 27.5px;"></div>
                        <span class="month-label mt-2">6</span>
                    </div>
                    <!-- Tháng 7 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 50px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 35px;"></div>
                        <span class="month-label mt-2">7</span>
                    </div>
                    <!-- Tháng 8 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 55px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 25px;"></div>
                        <span class="month-label mt-2">8</span>
                    </div>
                    <!-- Tháng 9 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 37.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 32.5px;"></div>
                        <span class="month-label mt-2">9</span>
                    </div>
                    <!-- Tháng 10 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 42.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 20px;"></div>
                        <span class="month-label mt-2">10</span>
                    </div>
                    <!-- Tháng 11 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 47.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 37.5px;"></div>
                        <span class="month-label mt-2">11</span>
                    </div>
                    <!-- Tháng 12 -->
                    <div class="d-flex flex-column align-items-center mx-2">
                        <div class="chart-bar regular-bar" style="height: 52.5px;"></div>
                        <div class="chart-bar voluntary-bar" style="height: 30px;"></div>
                        <span class="month-label mt-2">12</span>
                    </div>
                </div> --}}

                <!-- Biểu đồ doanh thu (Động) -->
                <div class="d-flex align-items-end gap-3 mt-4" id="chart-container">
                    {{#each doanhThuTheoThang}}
                        <div class="d-flex flex-column align-items-center mx-2">
                            <div class="chart-bar regular-bar" style="height: {{this.heightPhi}}px;"></div>
                            <div class="chart-bar voluntary-bar" style="height: {{this.heightTuThien}}px;"></div>
                            <span class="month-label mt-2">{{this.thang}}</span>
                        </div>
                    {{/each}}
                </div>


                <!-- Chú thích -->
                <div class="d-flex justify-content-between mt-3">
                    <div class="d-flex align-items-center">
                        <span class="chart-bar regular-bar" style="height: 10px;"></span>
                        <span class="ms-2 text-dark">Khoản thu định kỳ</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="chart-bar voluntary-bar" style="height: 10px;"></span>
                        <span class="ms-2 text-dark">Khoản đóng góp tự nguyện</span>
                    </div>
                </div>
            </section>

            <!-- Dân cư và Căn hộ -->
            <div class="bg-white p-4 rounded shadow mt-4">
                <div class="row">
                    <div class="col-md-6 text-dark d-flex flex-column align-items-center">
                        <h2>Dân cư</h2>
                        <div class="circle-container residents-circle">
                            <pre id="residents-count">{{soDanCu}}<br>người</pre>
                            <svg class="outer-ring" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" stroke-dasharray="282.6" stroke-dashoffset="141.3"
                                    stroke="#FFD700"></circle>
                            </svg>
                        </div>
                    </div>
                    <div class="col-md-6 text-dark d-flex flex-column align-items-center">
                        <h2>Căn hộ</h2>
                        <div class="circle-container apartments-circle">
                            <pre id="apartments-count">{{soCanHoTrong}} / {{tongCanHo}}<br>căn hộ</pre>
                            <svg class="outer-ring" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" stroke-dasharray="282.6" stroke-dashoffset="226"
                                    stroke="#8de5f9"></circle>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cột 2: Tỷ lệ phương tiện và Khoản thu gần đây -->
        <div class="col-md-4">
            <!-- Tỷ lệ phương tiện -->
            <div class="vehicle-container bg-white p-4 rounded shadow">
                <h2 class="text-sm">Đăng ký gửi xe</h2>
                <canvas id="myDoughnutChart" width="300" height="300" style="margin: left 30px;"></canvas>
            </div>

            <div class="transactions-container mt-4">
                <h2 class="text-sm fw-bold">Khoản thu gần đây</h2>
                <div id="transactions-list">
                    {{#each recentTransactions}}
                    <div class="transaction-item">
                        <div>Căn hộ {{this.canHo}} đã nộp {{type this.type "phí" "từ thiện"}} {{this.name}}</div>
                        <div class="fw-semibold">VND {{this.amount}}</div>
                    </div>
                    <div class="transaction-divider"></div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const ctx = document.getElementById('myDoughnutChart').getContext('2d');

    const data = {
        labels: [
            'Ô tô',
            'Xe máy',
        ],
        datasets: [{
            label: 'Sô lượng phương tiện',
            data: [{{tongOto}}, {{tongXeMay}}],
            backgroundColor: [
                'rgb(99, 102, 241)',
                'rgb(129, 140, 248)',
            ],
            hoverOffset: 4
        }]
    };

    const config = {
        type: 'doughnut',
        data: data,
        options: {
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    };

    const myDoughnutChart = new Chart(ctx, config);
</script>

