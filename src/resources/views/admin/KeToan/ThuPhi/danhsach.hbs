<div class="container py-4">

    <!-- B·ªô l·ªçc Thu ph√≠ -->
    <div class="container py-4">
        <h2 class="mb-4">üìã Danh s√°ch c√°c lo·∫°i ph√≠</h2>

        <!-- Form b·ªô l·ªçc -->
        <form class="mb-4">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="filterLoaiPhi" class="form-label">Lo·∫°i ph√≠</label>
                    <select class="form-select" id="filterLoaiPhi" name="loaiPhi">
                        <option value="">-- T·∫•t c·∫£ lo·∫°i ph√≠ --</option>
                        <option value="dien">ƒêi·ªán</option>
                        <option value="nuoc">N∆∞·ªõc</option>
                        <option value="Phi quan ly">Ph√≠ qu·∫£n l√Ω chung c∆∞</option>
                        <option value="Phidichvu">Ph√≠ d·ªãch v·ª• chung c∆∞</option>
                        <option value="Phuongtien">Ph∆∞∆°ng ti·ªán</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="filterThang" class="form-label">Th√°ng</label>
                    <input type="number" class="form-control" id="filterThang" name="thang" min="1" max="12"
                        placeholder="Th√°ng">
                </div>
                <div class="col-md-4">
                    <label for="filterNam" class="form-label">NƒÉm</label>
                    <input type="number" class="form-control" id="filterNam" name="nam" min="2000" placeholder="NƒÉm">
                </div>
            </div>

            <div class="mt-3 d-flex gap-2">
                <button type="button" class="btn btn-primary" onclick="filterTable()">T√¨m ki·∫øm</button>
                <button type="button" class="btn btn-secondary" onclick="resetFilter()">L√†m m·ªõi</button>
            </div>
        </form>

        <!-- B·∫£ng danh s√°ch Thu ph√≠ -->
        <div class="table-responsive">
            <table class="table table-bordered my-custom-table" id="thuPhiTable">
                <thead class="table-light">
                    <tr>
                        <th>Lo·∫°i ph√≠</th>
                        <th>Th√°ng</th>
                        <th>NƒÉm</th>
                        <th>T·ªïng s·ªë ti·ªÅn</th>
                        <th>S·ªë ti·ªÅn ƒë√£ thu</th>
                        <th>S·ªë cƒÉn h·ªô c√≥ kho·∫£n thu</th>
                        <th>Xem chi ti·∫øt</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each danhSach}}
                    <tr>
                        <td>{{this.loaiPhi}}</td>
                        <td>{{this.thang}}</td>
                        <td>{{this.nam}}</td>
                        <td>{{this.tongSoTien}}</td>
                        <td>{{this.tongSoTienDaThu}}</td>
                        <td>{{this.soCanHo}}</td>
                        <td>
                            <a href="/admin/thuphi/{{this.loaiPhi}}/{{this.thang}}/{{this.nam}}"
                                class="btn btn-link p-0 me-2"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                    height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2" />
                                </svg></a>
                        </td>
                    </tr>
                    {{else}}
                    <tr>
                        <td colspan="7" class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu.</td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // L·ªçc b·∫£ng Thu ph√≠ theo b·ªô l·ªçc
        function filterTable() {
            const loaiPhi = document.getElementById('filterLoaiPhi').value;
            const thang = document.getElementById('filterThang').value;
            const nam = document.getElementById('filterNam').value;

            const rows = document.querySelectorAll('#thuPhiTable tbody tr');
            rows.forEach(row => {
                const rowLoaiPhi = row.cells[0].innerText.trim();
                const rowThang = row.cells[1].innerText.trim();
                const rowNam = row.cells[2].innerText.trim();

                let matchLoaiPhi = false;

                if (!loaiPhi) {
                    // N·∫øu kh√¥ng ch·ªçn lo·∫°i ph√≠ => t·∫•t c·∫£
                    matchLoaiPhi = true;
                } else if (loaiPhi === 'Phidichvu') {
                    // N·∫øu ch·ªçn Phidichvu th√¨ t√¨m c√°c lo·∫°i ph√≠ con
                    matchLoaiPhi = (rowLoaiPhi === 'Phi dich vu nha o' || rowLoaiPhi === 'Phi dich vu cao cap');
                } else if (loaiPhi === 'Phuongtien') {
                    // N·∫øu ch·ªçn Phuongtien th√¨ t√¨m xemay ho·∫∑c oto
                    matchLoaiPhi = (rowLoaiPhi.toLowerCase() === 'xemay' || rowLoaiPhi.toLowerCase() === 'oto');
                } else {
                    // C√°c lo·∫°i ph√≠ kh√°c th√¨ so s√°nh ch√≠nh x√°c
                    matchLoaiPhi = (rowLoaiPhi === loaiPhi);
                }

                const matchThang = !thang || rowThang === thang;
                const matchNam = !nam || rowNam === nam;

                row.style.display = (matchLoaiPhi && matchThang && matchNam) ? '' : 'none';
            });

        }


        function resetFilter() {
            document.getElementById('filterLoaiPhi').value = '';
            document.getElementById('filterThang').value = '';
            document.getElementById('filterNam').value = '';
            filterTable();
        }
    </script>